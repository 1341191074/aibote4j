# ğŸš€ ä»»åŠ¡å¼•æ“ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

ä»»åŠ¡å¼•æ“æ˜¯ Aibote4J æ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒæä¾›äº†ä¸€å¥—å®Œæ•´çš„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼Œè®©æ‚¨å¯ä»¥è½»æ¾åœ°å®šä¹‰ã€æ³¨å†Œå’Œæ‰§è¡Œè‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚ç›¸æ¯”ç›´æ¥è°ƒç”¨æœºå™¨äººAPIï¼Œä»»åŠ¡å¼•æ“æä¾›äº†æ›´å¥½çš„ç»„ç»‡æ€§ã€å¯ç»´æŠ¤æ€§å’Œè‡ªåŠ¨åŒ–èƒ½åŠ›ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ä»»åŠ¡å¼•æ“ï¼Ÿ

ä»»åŠ¡å¼•æ“æ˜¯ä¸€ä¸ªé›†ä¸­å¼çš„ä»»åŠ¡ç®¡ç†å™¨ï¼Œè´Ÿè´£ï¼š
- **ä»»åŠ¡æ³¨å†Œ** - å°†è‡ªåŠ¨åŒ–ä»»åŠ¡æ³¨å†Œåˆ°ç³»ç»Ÿä¸­
- **ä»»åŠ¡è°ƒåº¦** - æ ¹æ®æ¡ä»¶è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡
- **ä»»åŠ¡æ‰§è¡Œ** - ç®¡ç†ä»»åŠ¡çš„å®Œæ•´æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ
- **ä»»åŠ¡ç›‘æ§** - è·Ÿè¸ªä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å’Œç»“æœ

### ä¸ºä»€ä¹ˆä½¿ç”¨ä»»åŠ¡å¼•æ“ï¼Ÿ

1. **ç®€åŒ–å¤æ‚æµç¨‹** - è‡ªåŠ¨å¤„ç†è¿æ¥ã€æ‰§è¡Œã€æ¸…ç†ç­‰æ­¥éª¤
2. **æé«˜å¯ç»´æŠ¤æ€§** - ä»»åŠ¡é€»è¾‘é›†ä¸­ç®¡ç†ï¼Œæ˜“äºä¿®æ”¹å’Œæ‰©å±•
3. **å¢å¼ºè‡ªåŠ¨åŒ–** - å®¢æˆ·ç«¯è¿æ¥æ—¶è‡ªåŠ¨æ‰§è¡Œé¢„è®¾ä»»åŠ¡
4. **æ›´å¥½çš„ç»„ç»‡æ€§** - å°†ç›¸å…³æ“ä½œå°è£…æˆç‹¬ç«‹çš„ä»»åŠ¡å•å…ƒ

## ğŸ› ï¸ å¿«é€Ÿå…¥é—¨

### 1. åˆ›å»ºä»»åŠ¡ç±»

```java
import net.aibote.task.impl.NotepadAutomationTask;

// åˆ›å»ºè®°äº‹æœ¬è‡ªåŠ¨åŒ–ä»»åŠ¡
NotepadAutomationTask task = NotepadAutomationTask.builder()
    .taskName("è®°äº‹æœ¬è‡ªåŠ¨åŒ–ä»»åŠ¡")
    .scriptName("Notepad-Bot")
    .description("è‡ªåŠ¨æŸ¥æ‰¾è®°äº‹æœ¬çª—å£å¹¶æ‰§è¡ŒåŸºæœ¬æ“ä½œ")
    .build();
```

### 2. æ³¨å†Œä»»åŠ¡

```java
import net.aibote.task.TaskEngine;

// è·å–ä»»åŠ¡å¼•æ“å®ä¾‹å¹¶æ³¨å†Œä»»åŠ¡
String taskId = TaskEngine.getInstance().registerTask("notepad-task", task);
System.out.println("ä»»åŠ¡å·²æ³¨å†Œï¼ŒID: " + taskId);
```

### 3. å¯åŠ¨æœåŠ¡ç«¯

```java
import net.aibote.Application;

// å¯åŠ¨æœåŠ¡ç«¯åº”ç”¨ï¼Œå®¢æˆ·ç«¯è¿æ¥æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œæ³¨å†Œçš„ä»»åŠ¡
Application.main(new String[]{});
```

## ğŸ“š è¯¦ç»†ä½¿ç”¨

### ä»»åŠ¡å®šä¹‰

æ¯ä¸ªä»»åŠ¡éƒ½éœ€è¦å®ç° `TaskDefinition` æ¥å£ï¼š

```java
@Data
@Builder
public class CustomTask implements TaskDefinition {
    
    private String taskName;
    private String scriptName;
    private String description;
    
    @Override
    public Set<BotFactory.BotType> getSupportedBotTypes() {
        // æŒ‡å®šæ”¯æŒçš„æœºå™¨äººç±»å‹
        return Set.of(BotFactory.BotType.WIN);
    }
    
    @Override
    public TaskExecutor getTaskExecutor() {
        // è¿”å›ä»»åŠ¡æ‰§è¡Œå™¨
        return this::executeTask;
    }
    
    /**
     * ä»»åŠ¡æ‰§è¡Œé€»è¾‘
     */
    private void executeTask(AbstractPlatformBot bot) throws Exception {
        // åœ¨è¿™é‡Œç¼–å†™å…·ä½“çš„è‡ªåŠ¨åŒ–é€»è¾‘
        if (!(bot instanceof WinBot)) {
            throw new IllegalArgumentException("æ­¤ä»»åŠ¡ä»…æ”¯æŒWindowsæœºå™¨äºº");
        }
        
        WinBot winBot = (WinBot) bot;
        
        // ç¤ºä¾‹ï¼šæŸ¥æ‰¾è®°äº‹æœ¬çª—å£å¹¶ç§»åŠ¨é¼ æ ‡
        String notepadWindow = winBot.findWindow("Notepad", "");
        if (notepadWindow != null) {
            winBot.moveMouse(notepadWindow, 100, 100, Mode.front, "");
        }
    }
}
```

### ä»»åŠ¡æ³¨å†Œå’Œç®¡ç†

```java
TaskEngine engine = TaskEngine.getInstance();

// æ³¨å†Œå¤šä¸ªä»»åŠ¡
NotepadAutomationTask task1 = NotepadAutomationTask.builder()
    .taskName("ä»»åŠ¡1")
    .scriptName("Script-1")
    .build();

NotepadAutomationTask task2 = NotepadAutomationTask.builder()
    .taskName("ä»»åŠ¡2")
    .scriptName("Script-2")
    .build();

String id1 = engine.registerTask("task-1", task1);
String id2 = engine.registerTask("task-2", task2);

// æŸ¥è¯¢ä»»åŠ¡
TaskDefinition task = engine.getTask(id1);
System.out.println("ä»»åŠ¡åç§°: " + task.getTaskName());

// è·å–æ‰€æœ‰ä»»åŠ¡
Map<String, TaskDefinition> allTasks = engine.getAllTasks();
System.out.println("æ€»ä»»åŠ¡æ•°: " + allTasks.size());

// ç§»é™¤ä»»åŠ¡
engine.removeTask(id1);
```

### æ‰‹åŠ¨æ‰§è¡Œä»»åŠ¡

```java
// æ‰‹åŠ¨æ‰§è¡ŒæŒ‡å®šä»»åŠ¡
TaskEngine engine = TaskEngine.getInstance();
engine.executeTask("task-id", channelContext, BotFactory.BotType.WIN);
```

## ğŸ¯ NotepadAutomationTask è¯¦è§£

### ä»»åŠ¡åŠŸèƒ½

`NotepadAutomationTask` æ˜¯ä¸€ä¸ªå†…ç½®çš„ç¤ºä¾‹ä»»åŠ¡ï¼Œæ¼”ç¤ºäº†åŸºæœ¬çš„Windowsè‡ªåŠ¨åŒ–æ“ä½œï¼š

```java
public class NotepadAutomationTask implements TaskDefinition {
    
    // ä»»åŠ¡åŸºæœ¬ä¿¡æ¯
    private String taskName;
    private String scriptName;  
    private String description;
    
    @Override
    public Set<BotFactory.BotType> getSupportedBotTypes() {
        // ä»…æ”¯æŒWindowså¹³å°
        return Set.of(BotFactory.BotType.WIN);
    }
    
    private void executeTask(AbstractPlatformBot bot) throws Exception {
        // ç¡®ä¿æ˜¯WinBotç±»å‹
        if (!(bot instanceof WinBot)) {
            throw new IllegalArgumentException("æ­¤ä»»åŠ¡ä»…æ”¯æŒWindowsæœºå™¨äºº");
        }
        
        WinBot winBot = (WinBot) bot;
        
        // ç­‰å¾…3ç§’è®©ç³»ç»Ÿç¨³å®š
        Thread.sleep(3000);
        
        // æŸ¥æ‰¾èµ„æºç®¡ç†å™¨çª—å£
        String cabinetWindow = winBot.findWindow("CabinetWClass", "");
        System.out.println("æ‰¾åˆ°çª—å£: " + cabinetWindow);
        
        // åœ¨å±å¹•ä¸Šç§»åŠ¨é¼ æ ‡
        winBot.moveMouse("", 100, 100, Mode.front, "");
    }
}
```

### ä½¿ç”¨ç¤ºä¾‹

```java
public class TaskExample {
    public static void main(String[] args) {
        // 1. åˆ›å»ºä»»åŠ¡å®ä¾‹
        NotepadAutomationTask task = NotepadAutomationTask.builder()
            .taskName("æˆ‘çš„è®°äº‹æœ¬ä»»åŠ¡")
            .scriptName("My-Notepad-Bot")
            .description("è‡ªåŠ¨åŒ–çš„è®°äº‹æœ¬æ“ä½œæ¼”ç¤º")
            .build();
        
        // 2. æ³¨å†Œä»»åŠ¡
        String taskId = TaskEngine.getInstance().registerTask("my-notepad-task", task);
        System.out.println("ä»»åŠ¡æ³¨å†ŒæˆåŠŸï¼ŒID: " + taskId);
        
        // 3. å¯åŠ¨æœåŠ¡ç«¯
        Application.main(args);
        
        // ç°åœ¨å½“Windowså®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªä»»åŠ¡
    }
}
```

## âš™ï¸ é«˜çº§åŠŸèƒ½

### ä»»åŠ¡é…ç½®

å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡æ¥ç®¡ç†ä»»åŠ¡ï¼š

```yaml
# bot-config.yml
tasks:
  default:
    - notepad-task
    - web-scraping-task
  schedules:
    notepad-task:
      cron: "0 0 9 * * *"  # æ¯å¤©9ç‚¹æ‰§è¡Œ
      enabled: true
```

### ä»»åŠ¡ç›‘æ§

```java
// ç›‘æ§ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
TaskEngine engine = TaskEngine.getInstance();

// æ·»åŠ æ‰§è¡Œç›‘å¬å™¨
engine.addExecutionListener(new TaskExecutionListener() {
    @Override
    public void onTaskStarted(String taskId, TaskDefinition task) {
        System.out.println("ä»»åŠ¡å¼€å§‹: " + task.getTaskName());
    }
    
    @Override
    public void onTaskCompleted(String taskId, TaskDefinition task) {
        System.out.println("ä»»åŠ¡å®Œæˆ: " + task.getTaskName());
    }
    
    @Override
    public void onTaskFailed(String taskId, TaskDefinition task, Exception error) {
        System.out.println("ä»»åŠ¡å¤±è´¥: " + task.getTaskName() + ", é”™è¯¯: " + error.getMessage());
    }
});
```

### æ‰¹é‡ä»»åŠ¡å¤„ç†

```java
// æ‰¹é‡æ³¨å†Œå’Œæ‰§è¡Œä»»åŠ¡
List<TaskDefinition> tasks = Arrays.asList(
    createNotepadTask(),
    createWebTask(),
    createAndroidTask()
);

List<String> taskIds = new ArrayList<>();
for (int i = 0; i < tasks.size(); i++) {
    String taskId = TaskEngine.getInstance().registerTask("batch-task-" + i, tasks.get(i));
    taskIds.add(taskId);
}

// å¹¶å‘æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡
taskIds.parallelStream().forEach(taskId -> {
    try {
        TaskEngine.getInstance().executeTask(taskId, channelContext, BotType.WIN);
    } catch (Exception e) {
        System.err.println("ä»»åŠ¡æ‰§è¡Œå¤±è´¥: " + taskId);
    }
});
```

## ğŸ“– æœ€ä½³å®è·µ

### 1. ä»»åŠ¡è®¾è®¡åŸåˆ™

```java
// âœ… å¥½çš„åšæ³•
@Builder
public class WellDesignedTask implements TaskDefinition {
    private final String taskName;
    private final String scriptName;
    private final int retryCount;
    private final long timeoutMs;
    
    @Override
    public void executeTask(AbstractPlatformBot bot) throws Exception {
        // æ·»åŠ é‡è¯•æœºåˆ¶
        for (int i = 0; i < retryCount; i++) {
            try {
                doExecute(bot);
                return; // æˆåŠŸåˆ™é€€å‡º
            } catch (Exception e) {
                if (i == retryCount - 1) throw e; // æœ€åä¸€æ¬¡å°è¯•å¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸
                Thread.sleep(1000); // ç­‰å¾…åé‡è¯•
            }
        }
    }
    
    private void doExecute(AbstractPlatformBot bot) throws Exception {
        // å…·ä½“çš„æ‰§è¡Œé€»è¾‘
    }
}
```

### 2. é”™è¯¯å¤„ç†

```java
@Override
public void executeTask(AbstractPlatformBot bot) throws Exception {
    try {
        // ä¸»è¦é€»è¾‘
        performMainOperations(bot);
    } catch (CommandException e) {
        // å‘½ä»¤æ‰§è¡Œé”™è¯¯
        log.error("å‘½ä»¤æ‰§è¡Œå¤±è´¥: {}", e.getMessage());
        handleCommandError(e);
    } catch (TimeoutException e) {
        // è¶…æ—¶é”™è¯¯
        log.error("æ“ä½œè¶…æ—¶: {}", e.getMessage());
        handleTimeoutError(e);
    } catch (Exception e) {
        // å…¶ä»–é”™è¯¯
        log.error("æœªçŸ¥é”™è¯¯", e);
        throw e; // é‡æ–°æŠ›å‡ºä»¥ä¾¿ä»»åŠ¡å¼•æ“å¤„ç†
    } finally {
        // æ¸…ç†èµ„æº
        cleanupResources();
    }
}
```

### 3. æ—¥å¿—è®°å½•

```java
private void executeTask(AbstractPlatformBot bot) throws Exception {
    log.info("å¼€å§‹æ‰§è¡Œä»»åŠ¡: {}", taskName);
    
    long startTime = System.currentTimeMillis();
    try {
        // æ‰§è¡Œå…·ä½“æ“ä½œ
        String result = bot.getWindowSize();
        log.debug("è·å–çª—å£å¤§å°: {}", result);
        
        // æ›´å¤šæ“ä½œ...
        
        log.info("ä»»åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶: {}ms", System.currentTimeMillis() - startTime);
    } catch (Exception e) {
        log.error("ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œè€—æ—¶: {}ms", System.currentTimeMillis() - startTime, e);
        throw e;
    }
}
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ä»»åŠ¡ä¸æ‰§è¡Œ**
   - æ£€æŸ¥ä»»åŠ¡æ˜¯å¦æ­£ç¡®æ³¨å†Œ
   - ç¡®è®¤æ”¯æŒçš„æœºå™¨äººç±»å‹åŒ¹é…
   - éªŒè¯å®¢æˆ·ç«¯è¿æ¥çŠ¶æ€

2. **æ‰§è¡Œå¼‚å¸¸**
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
   - æ£€æŸ¥æœºå™¨äººè¿æ¥çŠ¶æ€
   - éªŒè¯å‚æ•°æœ‰æ•ˆæ€§

3. **æ€§èƒ½é—®é¢˜**
   - ä¼˜åŒ–ä»»åŠ¡æ‰§è¡Œé€»è¾‘
   - è°ƒæ•´è¶…æ—¶å’Œé‡è¯•é…ç½®
   - è€ƒè™‘æ‰¹é‡å¤„ç†

### è°ƒè¯•æŠ€å·§

```java
// å¯ç”¨è¯¦ç»†æ—¥å¿—
System.setProperty("logging.level.net.aibote", "DEBUG");

// æ·»åŠ æ‰§è¡Œè·Ÿè¸ª
TaskEngine.getInstance().addExecutionListener(new TaskExecutionListener() {
    @Override
    public void onTaskStarted(String taskId, TaskDefinition task) {
        System.out.println("[DEBUG] ä»»åŠ¡å¼€å§‹æ‰§è¡Œ: " + task.getTaskName());
    }
});
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](../01-å…¥é—¨æŒ‡å—/03-å¿«é€Ÿå¼€å§‹.md) - åŸºç¡€ä½¿ç”¨æ•™ç¨‹
- [Windowsè‡ªåŠ¨åŒ–](02-Windowsè‡ªåŠ¨åŒ–.md) - Windowså¹³å°è¯¦ç»†API
- [æ¶æ„è®¾è®¡](../04-é«˜çº§ä¸»é¢˜/01-æ¶æ„è®¾è®¡.md) - ç³»ç»Ÿæ¶æ„è¯´æ˜
- [APIå‚è€ƒ](../03-APIå‚è€ƒ/01-Windows-API.md) - å®Œæ•´APIæ–‡æ¡£

---
**æœ€åæ›´æ–°**: 2026-02-04